<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta name="generator" content="WASM-4 2.3.2" />
    <script id="wasm4-disk-prefix" type="text/plain">Hello Porth!</script>
    <title>Hello Porth!</title>
    <style type="text/css" id="wasm4-css">*{box-sizing:border-box}html,body{height:100%;margin:0}body{background:#202020;touch-action:none;font-family:system-ui}.container{width:100%;height:100%;display:flex;align-items:center;justify-content:center}#content{width:100vmin;height:100vmin;overflow:hidden}#content canvas,#screenshot img{width:100%;height:100%;image-rendering:pixelated;image-rendering:crisp-edges;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}@media (pointer: fine){#gamepad{display:none}}body.focus .infobox,body.focus #screenshot{display:none}body:not(.focus) #gamepad{display:none}#gamepad{pointer-events:none}#gamepad-dpad{position:absolute;width:39px;height:120px;left:69px;bottom:30px;background:#444;border-radius:9px}#gamepad-dpad:before{position:absolute;width:120px;height:39px;top:39px;left:-39px;background:#444;border-radius:9px;content:""}#gamepad-dpad:after{position:absolute;height:39px;width:39px;top:39px;border-radius:100%;background:#333;content:""}#gamepad-dpad.pressed-left:before{border-left:4px solid #A93671;width:116px}#gamepad-dpad.pressed-right:before{border-right:4px solid #A93671;width:116px}#gamepad-dpad.pressed-up{border-top:4px solid #A93671}#gamepad-dpad.pressed-down{border-bottom:4px solid #A93671;height:116px}#gamepad-action1{right:80px;bottom:30px}#gamepad-action2{right:30px;bottom:90px}#gamepad-action1,#gamepad-action2{position:absolute;width:60px;height:60px;border:4px solid #A93671;border-radius:50px}#gamepad-action1.pressed,#gamepad-action2.pressed{background:#A93671}.play-button{box-sizing:border-box;display:block;transform:scale(4);width:22px;height:22px;border:2px solid;border-radius:20px;position:absolute;top:calc(50vmin - 11px);left:calc(50vmin - 11px)}.play-button:before{content:"";display:block;box-sizing:border-box;position:absolute;width:0;height:10px;border-top:5px solid transparent;border-bottom:5px solid transparent;border-left:6px solid;top:4px;left:7px}.infobox{position:absolute;background:rgba(0,0,0,.8);width:100vmin;height:100%;color:#fff;padding:20px;cursor:pointer}body{overflow:hidden}
</style>
  </head>
  <body>
    <div class="container">
      <div id="content">
        <div class="infobox">
          <h2 id="title"></h2>
          <h4 id="author"></h4>
          <span class="play-button"></span>
        </div>
        <div id="screenshot"></div>
      </div>
    </div>
    <div id="gamepad">
      <div id="gamepad-dpad"></div>
      <div id="gamepad-action1"></div>
      <div id="gamepad-action2"></div>
    </div>
    <script
      id="wasm4-cart-json"
      type="application/json"
    >{"WASM4_CART":"0ax}=0rr910tkJy003ycE/J<UE$8}Fu&QjS0VzaxwO#U]By/Ys00imlzGVk3wO(vaC(^%D0$tUs009f400000000062MYzQl9cTX3KmpC1-[=]A=.o=26B(}vru5X2muj&3>rpsE?h-b01YkP01Yku5ch&Z5cJKEaPSbRaor2Q3NkVME)Ka(11jiJa]%#Z?#^Zp05:(Uli2*Aaos+hybMa[3N2JLE)Ka(11jiJa]<}e?VEQw0SUK^?VB#3k)g%Y0SSPB0rW/.0UtFU01YnS0DodYaouu>0$ULx1on#u3J{Cv3>1][0E(r]a]&.=k[d{Sa]&.=k[OoYa]&.=k)qvKa]&>*aojXkCc:Ko0dV>&5cPt7SsPdtA@XI:gy%T11sKrK5cAEHlbrKj0$URE0UtFMk)m/45cJKEy7HFk&4>]D5cKx.01Ykz2TKjD5cAEE5cryC8BjJr0$UOD1zOFIlhikE0$UOD1u3qYlhikE13[4v0$UIB0UtFC1zOFI5cJKEhuA<^bMHag5cCi35cAED5cK()070nl5cCk/gy%T11p$X]0SS=r3YC8^k]71l5cKM+01Ykz0t2n$>RA+L5cKM+01Ykz1p$YS5cAED5cM$:0$UJ1>RA+L5cJKEiSGdC01Ykz1p$Ya5cAED1vblO5cAEHk(?J05cJKEmI2Uk1oZ$QPFEbY1WPjC5cAqa[g$QT5cJKEhuA>A%nS975cAEHk[1qb5cJKEhuA<&2[4cj0rtBzgy%T10t2wZ0SS=lk(?J05cJKEy7HEU0UtFC1u3qYleTKg0$UO-0SS=lk)m/45cSQD5cJ[q01Ykz1p$Y95cAED1v9Ia3QKLz5cAEDc&%wW13#Yr5cCiv5cAEB5cryC5cM.V0$UO-0SS=llguVw0$UO-0SS=l5cJKE5cJKAl6.J.13)8413%EN5cAED5cJKE5c97CgxvFwPFD%bnm=QNzY&a&B8r62nm=QNzY?>{A=+$r08NYEB8@EjaA}mnz7NN!yH}=m","WASM4_CART_SIZE":804}</script>
    <script id="wasm4-js">(function(){var C5,x5,L5,R5;"use strict";const U=160,S=160,u5=1024,_5="WASM-4",M5=[14743759,8831084,3172432,464929],o5=4,j=20,r5=22,h5=26,m5=28,P5=30,B5=31,I5=160,F=1,O=2,$=16,J=32,Q=64,t5=128,F5=1,O5=2,p5=1,w5=2,b5=4,N5=Uint8Array.of(255,255,255,255,255,255,255,255,199,199,199,207,207,255,207,255,147,147,147,255,255,255,255,255,147,1,147,147,147,1,147,255,239,131,47,131,233,3,239,255,157,91,55,239,217,181,115,255,143,39,39,143,37,51,129,255,207,207,207,255,255,255,255,255,243,231,207,207,207,231,243,255,159,207,231,231,231,207,159,255,255,147,199,1,199,147,255,255,255,231,231,129,231,231,255,255,255,255,255,255,255,207,207,159,255,255,255,129,255,255,255,255,255,255,255,255,255,207,207,255,253,251,247,239,223,191,127,255,199,179,57,57,57,155,199,255,231,199,231,231,231,231,129,255,131,57,241,195,135,31,1,255,129,243,231,195,249,57,131,255,227,195,147,51,1,243,243,255,3,63,3,249,249,57,131,255,195,159,63,3,57,57,131,255,1,57,243,231,207,207,207,255,135,59,27,135,97,121,131,255,131,57,57,129,249,243,135,255,255,207,207,255,207,207,255,255,255,207,207,255,207,207,159,255,243,231,207,159,207,231,243,255,255,255,1,255,1,255,255,255,159,207,231,243,231,207,159,255,131,1,57,243,199,255,199,255,131,125,69,85,65,127,131,255,199,147,57,57,1,57,57,255,3,57,57,3,57,57,3,255,195,153,63,63,63,153,195,255,7,51,57,57,57,51,7,255,1,63,63,3,63,63,1,255,1,63,63,3,63,63,63,255,193,159,63,49,57,153,193,255,57,57,57,1,57,57,57,255,129,231,231,231,231,231,129,255,249,249,249,249,249,57,131,255,57,51,39,15,7,35,49,255,159,159,159,159,159,159,129,255,57,17,1,1,41,57,57,255,57,25,9,1,33,49,57,255,131,57,57,57,57,57,131,255,3,57,57,57,3,63,63,255,131,57,57,57,33,51,133,255,3,57,57,49,7,35,49,255,135,51,63,131,249,57,131,255,129,231,231,231,231,231,231,255,57,57,57,57,57,57,131,255,57,57,57,17,131,199,239,255,57,57,41,1,1,17,57,255,57,17,131,199,131,17,57,255,153,153,153,195,231,231,231,255,1,241,227,199,143,31,1,255,195,207,207,207,207,207,195,255,127,191,223,239,247,251,253,255,135,231,231,231,231,231,135,255,199,147,255,255,255,255,255,255,255,255,255,255,255,255,255,1,239,247,255,255,255,255,255,255,255,255,131,249,129,57,129,255,63,63,3,57,57,57,131,255,255,255,129,63,63,63,129,255,249,249,129,57,57,57,129,255,255,255,131,57,1,63,131,255,241,231,129,231,231,231,231,255,255,255,129,57,57,129,249,131,63,63,3,57,57,57,57,255,231,255,199,231,231,231,129,255,243,255,227,243,243,243,243,135,63,63,49,3,7,35,49,255,199,231,231,231,231,231,129,255,255,255,3,73,73,73,73,255,255,255,3,57,57,57,57,255,255,255,131,57,57,57,131,255,255,255,3,57,57,3,63,63,255,255,129,57,57,129,249,249,255,255,145,143,159,159,159,255,255,255,131,63,131,249,3,255,231,231,129,231,231,231,231,255,255,255,57,57,57,57,129,255,255,255,153,153,153,195,231,255,255,255,73,73,73,73,129,255,255,255,57,1,199,1,57,255,255,255,57,57,57,129,249,131,255,255,1,227,199,143,1,255,243,231,231,207,231,231,243,255,231,231,231,231,231,231,231,255,159,207,207,231,207,207,159,255,255,255,143,69,227,255,255,255,255,255,255,255,255,147,147,255,131,41,41,17,41,41,131,255,131,57,9,17,33,57,131,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,131,17,33,125,33,17,131,255,131,17,9,125,9,17,131,255,131,17,57,85,17,17,131,255,131,17,17,85,57,17,131,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,231,255,231,231,199,199,199,255,239,131,41,47,41,131,239,255,195,153,159,3,159,159,1,255,255,165,219,219,219,165,255,255,153,153,195,129,231,129,231,255,231,231,231,255,231,231,231,255,195,153,135,219,225,153,195,255,147,255,255,255,255,255,255,255,195,189,102,94,94,102,189,195,135,195,147,195,255,255,255,255,255,201,147,39,147,201,255,255,255,255,129,249,249,255,255,255,255,255,255,255,255,255,255,255,195,189,70,90,70,90,189,195,131,255,255,255,255,255,255,255,239,215,239,255,255,255,255,255,231,231,129,231,231,255,129,255,199,243,231,195,255,255,255,255,195,231,243,199,255,255,255,255,247,239,255,255,255,255,255,255,255,255,51,51,51,51,9,63,193,149,181,149,193,245,245,255,255,255,255,207,207,255,255,255,255,255,255,255,255,255,247,207,231,199,231,195,255,255,255,255,199,147,147,199,255,255,255,255,255,39,147,201,147,39,255,255,189,59,183,173,217,177,125,255,189,59,183,169,221,187,113,255,29,187,215,45,217,177,125,255,199,255,199,159,57,1,131,255,223,239,199,147,57,1,57,255,247,239,199,147,57,1,57,255,199,147,199,147,57,1,57,255,203,167,199,147,57,1,57,255,147,255,199,147,57,1,57,255,239,215,199,147,57,1,57,255,193,135,39,33,7,39,33,255,195,153,63,63,153,195,247,207,223,239,1,63,3,63,1,255,247,239,1,63,3,63,1,255,199,147,1,63,3,63,1,255,147,255,1,63,3,63,1,255,239,247,129,231,231,231,129,255,247,239,129,231,231,231,129,255,231,195,129,231,231,231,129,255,153,255,129,231,231,231,129,255,135,147,153,9,153,147,135,255,203,167,25,9,1,33,49,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,187,215,239,215,187,255,255,131,57,49,41,25,57,131,255,223,239,57,57,57,57,131,255,247,239,57,57,57,57,131,255,199,147,255,57,57,57,131,255,147,255,57,57,57,57,131,255,247,239,153,153,195,231,231,255,63,3,57,57,57,3,63,255,195,153,153,147,153,137,147,255,223,239,131,249,129,57,129,255,247,239,131,249,129,57,129,255,199,147,131,249,129,57,129,255,203,167,131,249,129,57,129,255,147,255,131,249,129,57,129,255,239,215,131,249,129,57,129,255,255,255,131,233,129,47,131,255,255,255,129,63,63,129,247,207,223,239,131,57,1,63,131,255,247,239,131,57,1,63,131,255,199,147,131,57,1,63,131,255,147,255,131,57,1,63,131,255,223,239,255,199,231,231,129,255,247,239,255,199,231,231,129,255,199,147,255,199,231,231,129,255,147,255,199,231,231,231,129,255,155,135,103,131,57,57,131,255,203,167,3,57,57,57,57,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,231,255,129,255,231,255,255,255,255,131,49,41,25,131,255,223,239,57,57,57,57,129,255,247,239,57,57,57,57,129,255,199,147,255,57,57,57,129,255,147,255,57,57,57,57,129,255,247,239,57,57,57,129,249,131,63,63,3,57,57,3,63,63,147,255,57,57,57,129,249,131),G5="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),y5=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];function W5(o){const t=o.length,e=t%4,s=e?t+4-e:t;let n="",i=0,r=0;for(;i<s;){const a=i<t?o[i]:0;if(++i,r=r*256+a,i%4==0){let c=85*85*85*85;for(;c>=1;){const m=Math.floor(r/c)%85;n+=G5[m],c/=85}r=0}}return n}function g5(o,t){let e=0,s=0,n=o.length,i=t.length,r=0;if(o.length%5==0)for(;s<n;){let a=o.charCodeAt(s++)-32;if(a<0||a>=y5.length)return e;if(r=r*85+y5[a],s%5==0){let c=256*256*256;for(;c>=1;){if(e>=i)return e;t[e++]=r/c%256,c/=256}r=0}}return e}var A5=`(()=>{"use strict";var l=44100,V=.15,C=.25,k=class{constructor(){this.freq1=0;this.freq2=0;this.startTime=0;this.attackTime=0;this.decayTime=0;this.sustainTime=0;this.releaseTime=0;this.sustainVolume=0;this.peakVolume=0;this.phase=0;this.pulseDutyCycle=0;this.noiseSeed=1;this.noiseLastRandom=0}};function q(m,e,t){return m+t*(e-m)}function A(m,e){if(m<e){let t=m/e;return t+t-t*t}else if(m>1-e){let t=(m-(1-e))/e;return 1-(t+t-t*t)}else return 1}var x=class extends AudioWorkletProcessor{constructor(){super();this.time=0,this.channels=new Array(4);for(let e=0;e<4;++e)this.channels[e]=new k;this.port!=null&&(this.port.onmessage=e=>{this.tone(...e.data)})}ramp(e,t,f,n){let y=(this.time-f)/(n-f);return q(e,t,y)}getCurrentFrequency(e){return e.freq2>0?this.ramp(e.freq1,e.freq2,e.startTime,e.releaseTime):e.freq1}getCurrentVolume(e){let t=this.time;return t>=e.sustainTime?this.ramp(e.sustainVolume,0,e.sustainTime,e.releaseTime):t>=e.decayTime?e.sustainVolume:t>=e.attackTime?this.ramp(e.peakVolume,e.sustainVolume,e.attackTime,e.decayTime):this.ramp(0,e.peakVolume,e.startTime,e.attackTime)}tone(e,t,f,n){let y=e&65535,d=e>>16&65535,u=t&255,r=t>>8&255,h=t>>16&255,c=t>>24&255,p=Math.min(f&255,100),i=Math.min(f>>8&255,100),a=n&3,b=n>>2&3,s=this.channels[a];this.time>s.releaseTime&&(s.phase=a==2?.25:0),s.freq1=y,s.freq2=d,s.startTime=this.time,s.attackTime=s.startTime+(l*c/60>>>0),s.decayTime=s.attackTime+(l*h/60>>>0),s.sustainTime=s.decayTime+(l*u/60>>>0),s.releaseTime=s.sustainTime+(l*r/60>>>0);let o=a==2?C:V;if(s.sustainVolume=o*p/100,s.peakVolume=i?o*i/100:o,a==0||a==1)switch(b){case 0:s.pulseDutyCycle=.125;break;case 1:case 3:default:s.pulseDutyCycle=.25;break;case 2:s.pulseDutyCycle=.5;break}else a==2&&r==0&&(s.releaseTime+=l/1e3>>>0)}process(e,[[t]],f){for(let n=0,y=t.length;n<y;++n,++this.time){let d=0;for(let u=0;u<4;++u){let r=this.channels[u];if(this.time<r.releaseTime){let h=this.getCurrentFrequency(r),c=this.getCurrentVolume(r),p;if(u==3){for(r.phase+=h*h/(1e6/44100*l);r.phase>0;){r.phase--;let i=r.noiseSeed;i^=i>>7,i^=i<<9,i^=i>>13,r.noiseSeed=i,r.noiseLastRandom=((i&1)<<1)-1}p=c*r.noiseLastRandom}else{let i=h/l,a=r.phase+i;if(a>=1&&a--,r.phase=a,u==2)p=c*(2*Math.abs(2*r.phase-1)-1);else{let b,s,o,T=r.pulseDutyCycle;a<T?(b=a/T,s=i/T,o=c):(b=(a-T)/(1-T),s=i/(1-T),o=-c),p=o*A(b,s)}}d+=p}}t[n]=d}return!0}};registerProcessor("wasm4-apu",x);})();
`;class H5{async init(){const t=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100});this.audioCtx=t;const e=new Blob([A5],{type:"application/javascript"}),s=URL.createObjectURL(e);try{await t.audioWorklet.addModule(s);const n=new AudioWorkletNode(t,"wasm4-apu");this.processorPort=n.port,n.connect(t.destination)}catch(n){console.warn("AudioWorklet loading failed, falling back to slow audio",n);let i;const r=(m,l)=>{i=new l};new Function("registerProcessor","AudioWorkletProcessor",A5)(r,class{}),this.processor=i;const c=t.createScriptProcessor(1024,0,1);c.onaudioprocess=m=>{const l=m.outputBuffer.getChannelData(0);i.process(null,[[l]])},c.connect(t.destination)}}tone(t,e,s,n){const i=this.processorPort;i!=null?i.postMessage([t,e,s,n]):this.processor.tone(t,e,s,n)}unlockAudio(){const t=this.audioCtx;t.state=="suspended"&&t.resume()}pauseAudio(){const t=this.audioCtx;t.state=="running"&&t.suspend()}}class V5{constructor(t){this.bytes=new Uint8Array(t,I5,U*S>>>2),this.drawColors=new Uint16Array(t,j,1)}clear(){this.bytes.fill(0)}drawPoint(t,e,s){const n=U*s+e>>>2,i=(e&3)<<1,r=3<<i;this.bytes[n]=t<<i|this.bytes[n]&~r}drawPointUnclipped(t,e,s){e>=0&&e<U&&s>=0&&s<S&&this.drawPoint(t,e,s)}drawHLineFast(t,e,s,n){const i=n-(n&3),r=Math.min(e+3&~3,i);if(i-r>3){for(let l=e;l<r;l++)this.drawPoint(t,l,s);const a=U*s+r>>>2,c=U*s+i>>>2,m=t*85;this.bytes.fill(m,a,c),e=i}for(let a=e;a<n;a++)this.drawPoint(t,a,s)}drawHLineUnclipped(t,e,s,n){s>=0&&s<S&&(e<0&&(e=0),n>U&&(n=U),e<n&&this.drawHLineFast(t,e,s,n))}drawHLine(t,e,s){const n=this.drawColors[0]&15;if(n==0)return;const i=n-1&3;this.drawHLineUnclipped(i,t,e,t+s)}drawVLine(t,e,s){if(e+s<=0||t<0||t>=U)return;const n=this.drawColors[0]&15;if(n==0)return;const i=Math.max(0,e),r=Math.min(S,e+s),a=n-1&3;for(let c=i;c<r;c++)this.drawPoint(a,t,c)}drawRect(t,e,s,n){const i=Math.max(0,t),r=Math.max(0,e),a=t+s,c=e+n,m=Math.min(a,U),l=Math.min(c,S),h=this.drawColors[0],f=h&15,p=h>>>4&15;if(f!==0){const y=f-1&3;for(let b=r;b<l;++b)this.drawHLineFast(y,i,b,m)}if(p!==0){const y=p-1&3;if(t>=0&&t<U)for(let b=r;b<l;++b)this.drawPoint(y,t,b);if(a>=0&&a<=U)for(let b=r;b<l;++b)this.drawPoint(y,a-1,b);e>=0&&e<S&&this.drawHLineFast(y,i,e,m),c>=0&&c<=S&&this.drawHLineFast(y,i,c-1,m)}}drawOval(t,e,s,n){const i=this.drawColors[0],r=i&15,a=i>>>4&15;if(a===15)return;const c=a-1&3,m=r-1&3,l=s>>>1,h=n>>>1;if(l<=0||h<=0)return;const f=t+l,p=e+h,y=l*l*2,b=h*h*2;{let g=l,E=0,T=(1-2*l)*h*h,k=l*l,x=b*l,D=0,R=0;for(;x>=D;){if(this.drawPointUnclipped(c,f+g,p+E),this.drawPointUnclipped(c,f+g,p-E),this.drawPointUnclipped(c,f-g,p+E),this.drawPointUnclipped(c,f-g,p-E),r!==0){const L=f-g+1,C=f+g;this.drawHLineUnclipped(m,L,p+E,C),this.drawHLineUnclipped(m,L,p-E,C)}E++,D+=y,R+=k,k+=y,2*R+T>0&&(g--,x-=b,R+=T,T+=b)}}{let g=0,E=h,T=h*h,k=(1-2*h)*l*l,x=0,D=y*h,R=0,L=0;for(;D>=x;)if(this.drawPointUnclipped(c,f+g,p+E),this.drawPointUnclipped(c,f+g,p-E),this.drawPointUnclipped(c,f-g,p+E),this.drawPointUnclipped(c,f-g,p-E),g++,x+=b,R+=T,T+=b,L++,2*R+k>0){if(r!==0){const C=g-L-1,_=f-C,I=f+C+1;this.drawHLineUnclipped(m,_,p+E,I),this.drawHLineUnclipped(m,_,p-E,I)}E--,D-=y,R+=k,k+=y,L=0}}}drawLine(t,e,s,n){const r=this.drawColors[0]&15;if(r===0)return;const a=r-1&3;if(e>n){let p=t;t=s,s=p,p=e,e=n,n=p}const c=Math.abs(s-t),m=t<s?1:-1,l=n-e;let h=(c>l?c:-l)/2,f;for(;this.drawPointUnclipped(a,t,e),!(t===s&&e===n);)f=h,f>-c&&(h-=l,t+=m),f<l&&(h+=c,e++)}drawText(t,e,s){let n=e;for(let i=0,r=t.length;i<r;++i){const a=t[i];switch(a){case 0:return;case 10:s+=8,n=e;break;default:this.blit(N5,n,s,8,8,0,a-32<<3,8),n+=8;break}}}blit(t,e,s,n,i,r,a,c,m=!1,l=!1,h=!1,f=!1){const p=this.drawColors[0];let y,b,g,E;f?(l=!l,y=Math.max(0,s)-s,b=Math.max(0,e)-e,g=Math.min(n,S-s),E=Math.min(i,U-e)):(y=Math.max(0,e)-e,b=Math.max(0,s)-s,g=Math.min(n,U-e),E=Math.min(i,S-s));for(let T=b;T<E;T++)for(let k=y;k<g;k++){const x=e+(f?T:k),D=s+(f?k:T),R=r+(l?n-k-1:k),L=a+(h?i-T-1:T);let C;const _=L*c+R;if(m){const Y=t[_>>>2],K=6-((_&3)<<1);C=Y>>>K&3}else{const Y=t[_>>>3],K=7-(_&7);C=Y>>>K&1}const I=p>>>(C<<2)&15;I!==0&&this.drawPoint(I-1&3,x,D)}}}const Y5=4,K5=35044,E5=34962,T5=5121,q5=5126,s5=6409,z5=35632,X5=35633,Z5=35713,j5=35714,U5=9728,$5=10240,J5=10241,Q5=10242,tt=10243,N=3553,et=33984,S5=33071,G=4;class st{constructor(t){this.gl=t,this.colorBuffer=new Uint32Array(U*S>>2),this.paletteBuffer=new Float32Array(3*G),this.lastPalette=Array(G),this.paletteLocation=null;const e=new Uint32Array(256);for(let n=0;n<256;++n){const i=n>>6&3,r=n>>4&3,a=n>>2&3,c=n&3;e[n]=i<<30|r<<22|a<<14|c<<6}this.table=e;const s=t.canvas;s.addEventListener("webglcontextlost",n=>{n.preventDefault()}),s.addEventListener("webglcontextrestored",()=>{this.initGL()}),this.initGL()}initGL(){const t=this.gl;this.lastPalette=Array(G);function e(h,f){const p=t.createShader(h);if(t.shaderSource(p,f),t.compileShader(p),t.getShaderParameter(p,Z5)==0)throw new Error(t.getShaderInfoLog(p)+"");return p}function s(h){const f=t.createTexture();t.activeTexture(h),t.bindTexture(N,f),t.texParameteri(N,Q5,S5),t.texParameteri(N,tt,S5),t.texParameteri(N,$5,U5),t.texParameteri(N,J5,U5)}const n=e(X5,`
            attribute vec2 pos;
            varying vec2 framebufferCoord;

            void main () {
                framebufferCoord = pos*vec2(0.5, -0.5) + 0.5;
                gl_Position = vec4(pos, 0, 1);
            }
        `),i=Array.from({length:G-1},(h,f)=>`p = mix(p, palette[${f+1}],  step(${((f+1)/G).toFixed(2)}, index));`).join(`
`),r=e(z5,`
            precision mediump float;
            uniform vec3 palette[${G}];
            uniform sampler2D framebuffer;
            varying vec2 framebufferCoord;

            vec3 lookup(float index) {
                vec3 p = palette[0];
                ${i}
                return p;
            }

            void main () {
                gl_FragColor = vec4(lookup(texture2D(framebuffer, framebufferCoord).r), 1.);
            }
        `),a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,r),t.linkProgram(a),t.getProgramParameter(a,j5)==0)throw new Error(t.getProgramInfoLog(a)+"");t.useProgram(a),this.paletteLocation=t.getUniformLocation(a,"palette"),t.uniform1i(t.getUniformLocation(a,"framebuffer"),0),t.detachShader(a,n),t.deleteShader(n),t.detachShader(a,r),t.deleteShader(r),s(et),t.texImage2D(N,0,s5,U,S,0,s5,T5,null);const c=t.getAttribLocation(a,"pos"),m=t.createBuffer(),l=new Float32Array([-1,-1,-1,1,1,1,1,1,1,-1,-1,-1]);t.bindBuffer(E5,m),t.bufferData(E5,l,K5),t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,q5,!1,0,0)}composite(t,e){const s=this.gl,n=e.bytes,i=this.colorBuffer,r=this.table,a=this.lastPalette,c=this.paletteBuffer;let m=!1;for(let l=0,h=0;l<G;++l){const f=t[l];m=m||a[l]!==f,c[h++]=(f>>16&255)/255,c[h++]=(f>>8&255)/255,c[h++]=(f&255)/255,a[l]=f}m&&s.uniform3fv(this.paletteLocation,this.paletteBuffer);for(let l=0;l<U*S>>2;++l)i[l]=r[n[l]];s.texImage2D(N,0,s5,U,S,0,s5,T5,new Uint8Array(i.buffer)),s.drawArrays(Y5,0,6)}}class nt{constructor(t){this.warnedFileSize=!1,this.updateIdleState=()=>{!document.body.classList.contains("focus")?(this.pauseAudio(),this.pauseState|=p5):(this.unlockAudio(),this.pauseState&=~p5)};const e=document.createElement("canvas");e.width=U,e.height=S,this.canvas=e;const s=e.getContext("webgl",{alpha:!1,depth:!1,antialias:!1});if(!s)throw new Error("web-runtime: could not create wegl context");this.compositor=new st(s),this.apu=new H5,this.diskName=t,this.diskBuffer=new ArrayBuffer(u5);let n;try{n=localStorage.getItem(t)}catch(i){console.error("Error reading disk",i)}this.diskSize=n!=null?g5(n,new Uint8Array(this.diskBuffer)):0,this.memory=new WebAssembly.Memory({initial:1,maximum:1}),this.data=new DataView(this.memory.buffer),this.framebuffer=new V5(this.memory.buffer),this.reset(),this.pauseState=0,this.wasmBufferByteLen=0}async init(){await this.apu.init()}setMouse(t,e,s){this.data.setInt16(h5,t,!0),this.data.setInt16(m5,e,!0),this.data.setUint8(P5,s)}setGamepad(t,e){this.data.setUint8(r5+t,e)}getGamepad(t){return this.data.getUint8(r5+t)}getSystemFlag(t){return this.data.getUint8(B5)&t}maskGamepad(t,e,s){const n=r5+t;let i=this.data.getUint8(n);s?i|=e:i&=~e,this.data.setUint8(n,i)}unlockAudio(){this.apu.unlockAudio()}pauseAudio(){this.apu.pauseAudio()}reset(t){const e=new Uint32Array(this.memory.buffer);t&&e.fill(0),this.pauseState&=~w5,e.set(M5,o5>>2),this.data.setUint16(j,4611,!0),this.data.setInt16(h5,32767,!0),this.data.setInt16(m5,32767,!0)}async load(t){const e=65535;if(this.wasmBufferByteLen=t.byteLength,t.byteLength>e)throw new Error("Cart too big!");const s={memory:this.memory,rect:this.framebuffer.drawRect.bind(this.framebuffer),oval:this.framebuffer.drawOval.bind(this.framebuffer),line:this.framebuffer.drawLine.bind(this.framebuffer),hline:this.framebuffer.drawHLine.bind(this.framebuffer),vline:this.framebuffer.drawVLine.bind(this.framebuffer),text:this.text.bind(this),textUtf8:this.textUtf8.bind(this),textUtf16:this.textUtf16.bind(this),blit:this.blit.bind(this),blitSub:this.blitSub.bind(this),tone:this.apu.tone.bind(this.apu),diskr:this.diskr.bind(this),diskw:this.diskw.bind(this),trace:this.trace.bind(this),traceUtf8:this.traceUtf8.bind(this),traceUtf16:this.traceUtf16.bind(this),tracef:this.tracef.bind(this)};await this.safeCall(async()=>{const n=await WebAssembly.instantiate(t,{env:s});this.wasm=n.instance,typeof this.wasm.exports._start=="function"&&this.wasm.exports._start(),typeof this.wasm.exports._initialize=="function"&&this.wasm.exports._initialize()})}async safeCall(t){if(typeof t=="function")try{await t()}catch(e){if(e instanceof WebAssembly.RuntimeError||e instanceof WebAssembly.LinkError||e instanceof WebAssembly.CompileError)this.blueScreen(e);else throw e}}text(t,e,s){const n=new Uint8Array(this.memory.buffer,t);this.framebuffer.drawText(n,e,s)}textUtf8(t,e,s,n){const i=new Uint8Array(this.memory.buffer,t,e);this.framebuffer.drawText(i,s,n)}textUtf16(t,e,s,n){const i=new Uint16Array(this.memory.buffer,t,e>>1);this.framebuffer.drawText(i,s,n)}blit(t,e,s,n,i,r){this.blitSub(t,e,s,n,i,0,0,n,r)}blitSub(t,e,s,n,i,r,a,c,m){const l=new Uint8Array(this.memory.buffer,t),h=m&1,f=m&2,p=m&4,y=m&8;this.framebuffer.blit(l,e,s,n,i,r,a,c,h,f,p,y)}diskr(t,e){const s=Math.min(e,this.diskSize),n=new Uint8Array(this.diskBuffer,0,s);return new Uint8Array(this.memory.buffer,t).set(n),s}diskw(t,e){const s=Math.min(e,u5),n=new Uint8Array(this.memory.buffer,t,s),i=new Uint8Array(this.diskBuffer),r=W5(n);try{localStorage.setItem(this.diskName,r)}catch(a){console.error("Error writing disk",a)}return i.set(n),this.diskSize=s,s}getCString(t){let e="";for(;;){const s=this.data.getUint8(t++);if(s==0)break;e+=String.fromCharCode(s)}return e}print(t,e=!1){e?console.error(t):console.log(t)}trace(t){this.print(this.getCString(t))}traceUtf8(t,e){const s=new Uint8Array(this.memory.buffer,t,e),n=new TextDecoder().decode(s);this.print(n)}traceUtf16(t,e){const s=new Uint8Array(this.memory.buffer,t,e),n=new TextDecoder("utf-16").decode(s);this.print(n)}tracef(t,e){var s="";let n;for(;n=this.data.getUint8(t++);)if(n==37)switch(n=this.data.getUint8(t++)){case 37:s+="%";break;case 99:s+=String.fromCharCode(this.data.getInt32(e,!0)),e+=4;break;case 100:case 120:s+=this.data.getInt32(e,!0).toString(n==100?10:16),e+=4;break;case 115:let i=this.data.getUint32(e,!0);s+=this.getCString(i),e+=4;break;case 102:s+=this.data.getFloat64(e,!0),e+=8;break}else s+=String.fromCharCode(n);this.print(s)}start(){this.safeCall(this.wasm.exports.start)}update(){this.pauseState==0&&(this.getSystemFlag(F5)||this.framebuffer.clear(),this.safeCall(this.wasm.exports.update),this.composite())}blueScreen(t){var p;this.pauseState|=w5;const e=[1118702,8831084,11184810,16777215],s=y=>[...y].map(b=>b.charCodeAt(0)),n=` ${_5} `,i=n,r=8*n.length,a=(160-8*n.length)/2,c=20,m=9,l=60;new Uint32Array(this.memory.buffer).set(e,o5>>2),this.data.setUint16(j,4611,!0),this.framebuffer.clear(),this.framebuffer.drawHLine(a,c-1,r),this.data.setUint16(j,4401,!0),this.framebuffer.drawText(s(i),a,c),this.data.setUint16(j,4611,!0);const f=it(t);this.framebuffer.drawText(s(f),m,l),this.composite(),this.print((p=t.stack)!=null?p:"",!0)}composite(){const t=new Uint32Array(this.memory.buffer,o5,4*4);this.compositor.composite(t,this.framebuffer)}}function it(o){let t=`${o.name}:
${o.message}`;return o instanceof WebAssembly.RuntimeError?(o.message.match(/unreachable/)?t=`The cartridge has
reached a code 
segment marked as
unreachable.`:o.message.match(/out of bounds/)&&(t=`The cartridge has
attempted a memory
access that is
out of bounds.`),t+=`




Hit R to reboot.`):o instanceof WebAssembly.LinkError?t=`The cartridge has
tried to import
a missing function.



See console for
more details.`:o instanceof WebAssembly.CompileError&&(t=`The cartridge is
corrupted.



See console for
more details.`),t}var ft="";const H=new URL(document.location.href).searchParams,a5=H.get("screenshot");if(a5!=null){const o=document.createElement("img");o.src=a5,(C5=document.getElementById("screenshot"))==null||C5.appendChild(o)}const c5=H.get("title");if(c5!=null){const o=document.getElementById("title");o&&(o.textContent=c5)}const k5=H.get("author");if(k5!=null){const o=document.getElementById("author");o&&(o.textContent="by "+k5)}const ot=((R5=(L5=(x5=document.getElementById("wasm4-disk-prefix"))==null?void 0:x5.textContent)!=null?L5:H.get("disk-prefix"))!=null?R5:c5)+"-disk";function V(o,t,e){!o||(e?o.classList.add(t):o.classList.remove(t))}async function rt(){var t;const o=document.getElementById("wasm4-cart-json");if(o){const{WASM4_CART:e,WASM4_CART_SIZE:s}=JSON.parse((t=o.textContent)!=null?t:""),n=new Uint8Array(s);return g5(e,n),n}else{const e=H.has("url")?H.get("url"):"cart.wasm";if(!e)throw new Error("web-runtime: missing cart url");return await(await fetch(e)).arrayBuffer()}}(async function(){var D5;const o=new nt(ot);await o.init();const t=o.canvas;(D5=document.getElementById("content"))==null||D5.appendChild(t);let e=await rt();await o.load(e);let s={toggleDevtools(){},updateCompleted(...u){}};a5!=null&&(await new Promise(u=>{window.onpointerdown=function(){window.onpointerdown=null,o.unlockAudio(),u()}}),window.onblur=function(){document.body.classList.remove("focus"),o.updateIdleState()},window.onfocus=function(){document.body.classList.add("focus"),o.updateIdleState()}),document.body.classList.add("focus"),o.start();async function n(){o.reset(!0),o.pauseState|=b5,await o.load(e),o.start(),o.pauseState&=~b5}function i(){o.composite(),t.toBlob(u=>{if(!u)throw new Error("web-runtime: missing blob in toBlob callback");const d=URL.createObjectURL(u),A=document.createElement("a");A.href=d,A.download="wasm4-screenshot.png",A.click(),URL.revokeObjectURL(d)})}let r=null;function a(){if(r!=null)return;const u="video/webm",d=t.captureStream();r=new MediaRecorder(d,{mimeType:u,videoBitsPerSecond:25e6});const A=[];r.ondataavailable=w=>{A.push(w.data)},r.onstop=()=>{const w=new Blob(A,{type:u}),v=URL.createObjectURL(w),W=document.createElement("a");W.href=v,W.download="wasm4-animation.webm",W.click(),URL.revokeObjectURL(v)},r.start(),setTimeout(()=>{r&&(r.requestData(),r.stop(),r=null)},4e3)}let c=null;function m(){c=new Uint32Array(o.memory.buffer.slice(0))}function l(){c!=null&&new Uint32Array(o.memory.buffer).set(c)}function h(){document.fullscreenElement==null&&document.body.requestFullscreen({navigationUI:"hide"})}let f=!1;function p(){f=!f,o.print(`Keyboard swapped to control gamepads ${f?"3 and 4":"1 and 2"}`)}const y=u=>{if(document.body.style.cursor="",u.isPrimary){const d=t.getBoundingClientRect(),A=Math.fround(U*(u.clientX-d.left)/d.width),w=Math.fround(S*(u.clientY-d.top)/d.height),v=u.buttons&7;o.setMouse(A,w,v)}};window.addEventListener("pointerdown",y),window.addEventListener("pointerup",y),window.addEventListener("pointermove",y),t.addEventListener("contextmenu",u=>{u.preventDefault()});const b={"2":m,"4":l,r:n,R:n,F7:p,F8:s.toggleDevtools,F9:i,F10:a,F11:h};let g=!0;const E=u=>{const d=u.type=="keydown";if(g||o.setGamepad(0,0),g=!0,o.unlockAudio(),document.body.style.cursor="none",d){const v=b[u.key];if(v){v(),u.preventDefault();return}}let A=0,w=0;switch(u.code){case"KeyX":case"KeyV":case"Space":case"KeyM":w=F;break;case"KeyZ":case"KeyC":case"KeyN":w=O;break;case"ArrowUp":w=Q;break;case"ArrowDown":w=t5;break;case"ArrowLeft":w=$;break;case"ArrowRight":w=J;break;case"ShiftLeft":case"Tab":A=1,w=F;break;case"KeyA":case"KeyQ":A=1,w=O;break;case"KeyE":A=1,w=Q;break;case"KeyD":A=1,w=t5;break;case"KeyS":A=1,w=$;break;case"KeyF":A=1,w=J;break}w!=0&&(u.preventDefault(),o.maskGamepad(A+(f?2:0),w,d))};window.addEventListener("keydown",E),window.addEventListener("keyup",E);let T=-1;function k(){if(T===-1)return;const u=navigator.getGamepads()[T];if(!u)return;const d=u.buttons,A=u.axes,w=d.length>12,v=w&&d[12].pressed||A[1]<-.5,W=w&&d[13].pressed||A[1]>.5,q=w&&d[14].pressed||A[0]<-.5,z=w&&d[15].pressed||A[0]>.5,X=d[0].pressed||d[6].pressed,l5=d[1].pressed||d[7].pressed;let M=0;M|=Q&-v,M|=t5&-W,M|=$&-q,M|=J&-z,M|=F&-X,M|=O&-l5,(M!==0||!g)&&(g=!1,o.setGamepad(0,M))}window.addEventListener("gamepadconnected",u=>{for(const d of navigator.getGamepads())if(d){T=d.index;break}}),window.addEventListener("gamepaddisconnected",u=>{if(u.gamepad.index===T){T=-1,o.setGamepad(0,0);for(const d of navigator.getGamepads())if(d){T=d.index;break}}});const x=document.getElementById("gamepad-dpad"),D=document.getElementById("gamepad-action1"),R=document.getElementById("gamepad-action2"),L=new Map;function C(u){if(u.type=="pointerup"&&(u.pointerType=="touch"&&h(),o.unlockAudio()),u.pointerType!="touch")return;switch(u.preventDefault(),u.type){case"pointerdown":case"pointermove":L.set(u.pointerId,u);break;default:L.delete(u.pointerId);break}let d=0;if(L.size){const v=100,W=10,q=50,z=3/5,X=x.getBoundingClientRect(),l5=X.x+X.width/2,M=X.y+X.height/2,n5=D.getBoundingClientRect(),at=n5.x+n5.width/2,ct=n5.y+n5.height/2,i5=R.getBoundingClientRect(),lt=i5.x+i5.width/2,dt=i5.y+i5.height/2;let P,B,e5,d5,f5;for(let Z of L.values())P=Z.clientX-l5,B=Z.clientY-M,e5=Math.sqrt(P*P+B*B),e5<v&&e5>W&&(d5=P/e5,f5=B/e5,-d5>z?d|=$:d5>z&&(d|=J),-f5>z?d|=Q:f5>z&&(d|=t5)),P=Z.clientX-at,B=Z.clientY-ct,P*P+B*B<q*q&&(d|=F),P=Z.clientX-lt,B=Z.clientY-dt,P*P+B*B<q*q&&(d|=O)}const A=d&(F|O),w=o.getGamepad(0)&(F|O);A&&!w&&navigator.vibrate(1),V(D,"pressed",d&F),V(R,"pressed",d&O),V(x,"pressed-left",d&$),V(x,"pressed-right",d&J),V(x,"pressed-up",d&Q),V(x,"pressed-down",d&t5),o.setGamepad(0,d)}window.addEventListener("pointercancel",C),window.addEventListener("pointerdown",C),window.addEventListener("pointermove",C),window.addEventListener("pointerup",C);const _=document.getElementById("gamepad"),I=1e3/60;let Y=performance.now(),K=Y;function v5(){k();const u=performance.now(),d=u-K;d>=I&&(Y=u,K=u-d%I,o.update(),_&&(_.style.display=o.getSystemFlag(O5)?"none":"")),requestAnimationFrame(v5)}v5()})()})();
</script>
  </body>
</html>
